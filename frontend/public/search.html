<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Page</title>
    <link rel="stylesheet" href="search.css">
</head>
<body>
<nav>
    <div class="logo">
        <img src="Images/logo.png" alt="DormDash Logo" />
    </div>
    <div class="menu">
        <a href="search.html">Listings</a>
        <a href="search.html">Favorites</a>
        <a href="about.html">About us</a>
        <a href="#" onclick="logoutUser()">Log Out</a>
    </div>
</nav>
<main>
    <h1>Begin your search</h1>
    <p>Type in your desired school or city to find the ideal accommodations for your academic journey.</p>
    <form id="searchForm">
        <input type="text" placeholder="Enter School Name" name="school">
        <input type="date" name="start_date">
        <input type="date" name="end_date">
        <button type="submit">Search</button>
    </form>
    <div id="propertyResults" class="property-results">
        <!-- Property search results will be displayed here -->
    </div>
</main>
<script>
    function logoutUser() {
        localStorage.removeItem('userToken');
        window.location.href = 'index.html';
    }

    document.getElementById('searchForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent the default form submission
        const formData = new FormData(this);
        const searchParams = new URLSearchParams(formData).toString();
        console.log(searchParams)
        console.log('Form data:', Object.fromEntries(formData.entries()));
        // Add here the code to handle the form data, e.g., make an AJAX request or update the UI

        try {
            const response = await fetch(`http://localhost:8081/properties/search?${searchParams}`);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Failed to fetch properties');
            }

            console.log('Properties:', data);

            // Display the properties in the UI (e.g., as cards)
            const propertyResults = document.getElementById('propertyResults');
            propertyResults.innerHTML = ''; // Clear previous results

            data.forEach(property => {
                const propertyCard = document.createElement('div');
                propertyCard.classList.add('property-card');
                
                // Populate property card with details (adjust as needed)
                propertyCard.innerHTML = `
                    <h2>${property.title}</h2>
                    <p>${property.description}</p>
                    <p>Price per night: $${property.price_per_night}</p>
                    <p>Location: ${property.street}, ${property.city}, ${property.state}, ${property.zipcode}</p>
                    <p>Availability: ${property.availability_start_date} to ${property.availability_end_date}</p>
                `;

                propertyResults.appendChild(propertyCard);
            });
        } catch (error) {
            console.error('Error fetching properties:', error);
            // Display error message to the user
            alert('Failed to fetch properties. Please try again.');
        }
    });
</script>
</body>
</html>
